# Linux 系统管理与硬件基础

## 一切皆文件与 /dev 目录

Linux 遵循“一切皆文件”哲学，系统中的硬件设备（如硬盘、分区、终端、内存等）都以文件形式存在于 `/dev` 目录下。例如：

- `/dev/sda`：第一个SATA/SCSI硬盘
- `/dev/sda1`：第一个硬盘的第一个分区
- `/dev/null`：空设备，丢弃所有写入数据
- `/dev/tty`：终端设备

通过这种方式，用户和程序可以像操作普通文件一样操作硬件设备。

---

## 硬盘与分区管理

### 查看磁盘和分区

#### `lsblk` 命令

列出所有块设备（磁盘、分区、挂载点等）。

```bash
lsblk
```

#### `fdisk` 命令

用于MBR分区表的磁盘分区管理（适用于大多数传统磁盘）。

```bash
sudo fdisk /dev/sda
```
常用操作：
- `p`：显示分区表
- `n`：新建分区
- `d`：删除分区
- `w`：保存并退出
- `q`：不保存退出

#### `cfdisk` 命令

基于文本界面的分区工具，操作更直观。

```bash
sudo cfdisk /dev/sda
```

#### `mkfs` 命令

格式化分区为指定文件系统。

```bash
sudo mkfs.ext4 /dev/sda1
```

#### `fsck` 命令

检查和修复文件系统。

```bash
sudo fsck /dev/sda1
```

---

### 文件系统与磁盘挂载

#### 文件系统定义

文件系统（File System）是操作系统用于管理和存储文件的方式。常见类型有 ext4、xfs、btrfs、ntfs、fat32 等。

#### 挂载与分区

- **挂载（mount）**：将设备（如分区）关联到目录树的某个挂载点，使其内容可访问。
- **分区（partition）**：将物理磁盘划分为若干逻辑区域，每个分区可格式化为不同文件系统。

#### `df` 命令

显示文件系统磁盘空间使用情况。

```bash
df -h
```

#### `du` 命令

显示目录或文件的磁盘占用空间。

```bash
du -sh [目录/文件]
```

#### 挂载与卸载

- 挂载分区：
  ```bash
  sudo mount /dev/sda1 /mnt
  ```
- 卸载分区：
  ```bash
  sudo umount /mnt
  ```

#### `/etc/fstab` 文件

系统启动时自动挂载分区的配置文件。可编辑此文件实现自动挂载。

---

## 内存与进程管理

### `/proc` 目录

`/proc` 是一个虚拟文件系统，包含内核和进程的实时信息。常用文件有：

- `/proc/cpuinfo`：CPU信息
- `/proc/meminfo`：内存信息
- `/proc/[pid]/`：每个进程的详细信息

### `ps` 命令

用于查看当前系统进程状态。

```bash
ps aux
```
常用配合 `grep` 查找进程：
```bash
ps aux | grep ssh
```

### `top` / `htop` 命令

动态显示进程和系统资源占用。

```bash
top
htop  # 需安装，界面更友好
```

### `kill` / `killall` 命令

终止进程。

```bash
kill PID
killall 进程名
```

### `free` 命令

查看内存和swap使用情况。

```bash
free -h
```

### `swapon` / `swapoff` 命令

启用/禁用交换分区。

```bash
sudo swapon /dev/sda3
sudo swapoff /dev/sda3
```

---

## 其他硬件与驱动管理

- **驱动模块**：Linux 通过内核模块（.ko文件）支持各种硬件设备。
- 查看已加载模块：
  ```bash
  lsmod
  ```
- 加载/卸载模块：
  ```bash
  sudo modprobe 模块名
  sudo rmmod 模块名
  ```
- 查看硬件信息：
  ```bash
  lspci      # 列出PCI设备
  lsusb      # 列出USB设备
  lshw       # 显示详细硬件信息（需安装）
  ```

---

## 日志与服务管理

### 日志管理

- **/var/log/**：系统日志目录，常见如 `/var/log/syslog`、`/var/log/messages`
- **journalctl**（systemd系统）：查看系统日志  
  ```bash
  journalctl -xe
  ```

### 服务管理（systemd 与 openrc）

#### systemd 简介

systemd 是现代 Linux 发行版（如 Debian、Ubuntu、Fedora、Arch 等）默认的初始化系统和服务管理器。它负责系统启动、服务管理、日志记录等，统一了服务的启动、停止和管理方式。

常用 systemctl 命令：

- 查看服务状态：
  ```bash
  sudo systemctl status 服务名
  ```
- 启动服务：
  ```bash
  sudo systemctl start 服务名
  ```
- 停止服务：
  ```bash
  sudo systemctl stop 服务名
  ```
- 重启服务：
  ```bash
  sudo systemctl restart 服务名
  ```
- 查看所有已启动服务：
  ```bash
  systemctl list-units --type=service
  ```
- 设置服务开机自启/禁用：
  ```bash
  sudo systemctl enable 服务名
  sudo systemctl disable 服务名
  ```

#### openrc 简介

openrc 是部分发行版（如 Alpine Linux、Gentoo）常用的轻量级初始化系统和服务管理器，启动速度快，配置简单。

常用 openrc 命令：

- 启动服务：
  ```bash
  sudo rc-service 服务名 start
  ```
- 停止服务：
  ```bash
  sudo rc-service 服务名 stop
  ```
- 重启服务：
  ```bash
  sudo rc-service 服务名 restart
  ```
- 查看服务状态：
  ```bash
  rc-service 服务名 status
  ```
- 设置服务开机自启/禁用：
  ```bash
  sudo rc-update add 服务名 default
  sudo rc-update del 服务名 default
  ```

---

## 用户与权限管理

Linux 是多用户多任务系统，用户与权限管理是系统安全和资源分配的基础。

### 用户与组基础

- **用户（User）**：每个登录系统的账号。
- **组（Group）**：用户的集合，用于统一分配权限。
- 用户信息存储在 `/etc/passwd`，组信息存储在 `/etc/group`。

#### 查看当前用户和组信息

```bash
id
whoami           # 显示当前用户名
groups           # 显示当前用户所属组
```

#### 查看所有用户和组

```bash
cat /etc/passwd  # 查看所有用户
cat /etc/group   # 查看所有组
```

### 用户管理

- 添加用户（自动创建家目录）：
  ```bash
  sudo adduser 用户名
  ```
- 删除用户（不删除家目录）：
  ```bash
  sudo deluser 用户名
  ```
- 删除用户及其家目录：
  ```bash
  sudo deluser --remove-home 用户名
  ```
- 修改用户密码：
  ```bash
  sudo passwd 用户名
  ```
- 修改用户信息（如全名、shell）：
  ```bash
  sudo chfn 用户名
  sudo usermod -s /bin/bash 用户名
  ```

### 组管理

- 添加组：
  ```bash
  sudo addgroup 组名
  ```
- 删除组：
  ```bash
  sudo delgroup 组名
  ```
- 将用户加入组：
  ```bash
  sudo usermod -aG 组名 用户名
  ```
- 修改用户主组：
  ```bash
  sudo usermod -g 组名 用户名
  ```

### 权限管理

Linux 文件权限分为**所有者（user）**、**所属组（group）**、**其他用户（other）**三类，每类有读（r）、写（w）、执行（x）权限。

#### 查看文件权限

```bash
ls -l 文件名
```
输出示例：
```
-rwxr-xr-- 1 user group 1234 日期 文件名
```
- 前10位：类型和权限（如 `-rwxr-xr--`）
- 所有者、组、其他用户权限分别为3位

#### 修改权限

- 修改权限（数字法/符号法）：
  ```bash
  chmod 755 文件名         # rwxr-xr-x
  chmod u+x 文件名         # 给所有者加执行权限
  chmod g-w 文件名         # 去掉组写权限
  ```
- 修改所有者和组：
  ```bash
  sudo chown 新用户 文件名
  sudo chown 新用户:新组 文件名
  sudo chgrp 新组 文件名
  ```

#### 权限进阶

- **umask**：新建文件默认权限掩码
  ```bash
  umask
  ```
- **ACL（访问控制列表）**：更细粒度权限控制
  - 设置ACL：
    ```bash
    setfacl -m u:用户名:rwx 文件名
    ```
  - 查看ACL：
    ```bash
    getfacl 文件名
    ```

### sudo 权限与提权

- 普通用户临时获得管理员权限：
  ```bash
  sudo 命令
  ```
- 配置 sudo 权限（编辑 sudoers 文件）：
  ```bash
  sudo visudo
  ```
- 允许用户免密码 sudo（示例）：
  ```
  用户名 ALL=(ALL) NOPASSWD:ALL
  ```

---

> 合理管理用户、组和权限，是保障 Linux 系统安全和多用户协作的基础。

---

## 软链接与硬链接

- 创建软链接（快捷方式）：
  ```bash
  ln -s 源文件 目标链接
  ```

---

## 计划任务

- 编辑定时任务：
  ```bash
  crontab -e
  ```

---

## 远程管理与文件传输

- **scp**：基于SSH的文件拷贝  
  ```bash
  scp file user@host:/path/
  ```

---

## 小结

- `/dev` 目录下的设备文件让硬件管理统一、灵活
- 使用 `lsblk`、`fdisk`、`cfdisk`、`mkfs`、`fsck` 管理磁盘和分区
- `df`、`du` 检查磁盘空间
- 文件系统和挂载点决定数据的组织和访问方式，`/etc/fstab` 可实现自动挂载
- `/proc` 提供系统和进程实时信息，`ps`、`top`、`htop` 管理和监控进程
- `free`、`swapon`、`swapoff` 管理内存和交换空间
- 驱动模块和硬件工具帮助识别和管理设备
- 日志和服务管理、用户权限、计划任务、远程管理等是系统维护的重要组成部分

> 通过这些工具和理念，Linux 实现了高效、灵活的系统和硬件管理